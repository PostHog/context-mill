---
title: Amplitude Migration - Execute
description: Transform Amplitude SDK code to PostHog equivalents following the API mapping reference
---

For each file in `.posthog-migration.json`, apply the transformations below. 

## Package Changes

First, update dependencies:

1. **Uninstall Amplitude packages**:
   ```bash
   npm uninstall @amplitude/analytics-browser amplitude-js @amplitude/analytics-node
   ```

2. **Install PostHog**:
   ```bash
   npm install posthog-js
   ```

---

## Import Replacements

**BEFORE (Amplitude):**
```javascript
import { init, track, identify, setUserId, Identify, Revenue } from '@amplitude/analytics-browser';
import amplitude from 'amplitude-js';
import * as amplitude from '@amplitude/analytics-browser';
import { ampli } from './ampli';
```

**AFTER (PostHog):**
```javascript
import posthog from 'posthog-js';
import { PostHogProvider, usePostHog } from 'posthog-js/react';  // For React
```

---

## Initialization

**BEFORE (Amplitude):**
```javascript
import { init } from '@amplitude/analytics-browser';
init('AMPLITUDE_API_KEY');

// or
amplitude.getInstance().init('AMPLITUDE_API_KEY');

// or with Ampli
ampli.load({ client: { apiKey: 'AMPLITUDE_API_KEY' } });
```

**AFTER (PostHog):**
```javascript
import posthog from 'posthog-js';

posthog.init(process.env.NEXT_PUBLIC_POSTHOG_KEY, {
  api_host: process.env.NEXT_PUBLIC_POSTHOG_HOST,
  defaults: '2025-05-24',
  capture_exceptions: true,
});
```

Use the appropriate environment variable prefix for the framework:
- Next.js: `process.env.NEXT_PUBLIC_POSTHOG_KEY`
- Vite: `import.meta.env.VITE_PUBLIC_POSTHOG_KEY`
- Create React App: `process.env.REACT_APP_POSTHOG_KEY`

---

## Event Tracking

**BEFORE (Amplitude):**
```javascript
import { track } from '@amplitude/analytics-browser';
track('Button Clicked', { buttonName: 'signup' });

// or
amplitude.getInstance().logEvent('Button Clicked', { buttonName: 'signup' });

// or with Ampli
ampli.track({ event_type: 'Button Clicked', event_properties: { buttonName: 'signup' } });
ampli.buttonClicked({ buttonName: 'signup' });
```

**AFTER (PostHog):**
```javascript
posthog.capture('Button Clicked', { buttonName: 'signup' });
```

---

## User Identification

**BEFORE (Amplitude):**
```javascript
import { identify, setUserId, Identify } from '@amplitude/analytics-browser';

setUserId('user-123');
const identifyObj = new Identify();
identifyObj.set('email', 'user@example.com');
identify(identifyObj);

// or
amplitude.getInstance().setUserId('user-123');
amplitude.getInstance().setUserProperties({ email: 'user@example.com' });

// or with Ampli
ampli.identify('user-123', { email: 'user@example.com' });
```

**AFTER (PostHog):**
```javascript
posthog.identify('user-123', {
  email: 'user@example.com',
});
```

---

## Reset / Logout

**BEFORE (Amplitude):**
```javascript
import { reset } from '@amplitude/analytics-browser';
reset();

// or
amplitude.getInstance().setUserId(null);
amplitude.getInstance().regenerateDeviceId();
```

**AFTER (PostHog):**
```javascript
posthog.reset();
```

---

## Group / Company Identification

**BEFORE (Amplitude):**
```javascript
import { setGroup } from '@amplitude/analytics-browser';
setGroup('company', 'company-123');

// or
amplitude.getInstance().setGroup('company', 'company-123');
ampli.client.setGroup('test group', 'browser-ts-ampli');
ampli.client.groupIdentify('test group', 'browser-ts-ampli', amplitudeIdentify);
```

**AFTER (PostHog):**
```javascript
posthog.group('company', 'company-123', {
  // optional group properties
  name: 'Acme Inc',
});
```

---

## Revenue Tracking

**BEFORE (Amplitude):**
```javascript
import { revenue, Revenue } from '@amplitude/analytics-browser';

const revenueEvent = new Revenue()
  .setProductId('product-123')
  .setPrice(9.99)
  .setQuantity(1);
revenue(revenueEvent);
```

**AFTER (PostHog):**
```javascript
posthog.capture('purchase', {
  $set: { total_revenue: 9.99 },
  product_id: 'product-123',
  price: 9.99,
  quantity: 1,
});
```

---

## User Properties

**BEFORE (Amplitude):**
```javascript
amplitude.getInstance().setUserProperties({ plan: 'premium' });
```

**AFTER (PostHog):**
```javascript
posthog.capture('$set', {
  $set: { plan: 'premium' },
});

// Or include in identify call:
posthog.identify(userId, { plan: 'premium' });
```

---

## Opt-Out

**BEFORE (Amplitude):**
```javascript
amplitude.getInstance().setOptOut(true);
```

**AFTER (PostHog):**
```javascript
posthog.opt_out_capturing();

// To opt back in:
posthog.opt_in_capturing();
```

---

## Device ID

**BEFORE (Amplitude):**
```javascript
const deviceId = amplitude.getInstance().getDeviceId();
```

**AFTER (PostHog):**
```javascript
const distinctId = posthog.get_distinct_id();
```

---

## Next.js Projects

For Next.js projects, use the `instrumentation-client.ts|js` file. This replaces any Amplitude initialization in layout files, providers, or useEffect hooks.

**BEFORE (Amplitude in Next.js):**
```jsx
// app/layout.tsx or app/providers.tsx
import { init } from '@amplitude/analytics-browser';
import { ampli } from './ampli';

// Often in useEffect or provider
useEffect(() => {
  init('AMPLITUDE_API_KEY');
  // or
  ampli.load({ client: { apiKey: 'AMPLITUDE_API_KEY' } });
}, []);
```

**AFTER (PostHog with instrumentation-client):**

Create `instrumentation-client.ts` (or `.js`) at the **root of your Next.js app** (same level as `app/` or `pages/`):

```typescript
// instrumentation-client.ts
import posthog from 'posthog-js'

posthog.init(process.env.NEXT_PUBLIC_POSTHOG_KEY!, {
  api_host: process.env.NEXT_PUBLIC_POSTHOG_HOST,
  defaults: '2025-05-24',
})
```

Or in JavaScript:
```javascript
// instrumentation-client.js
import posthog from 'posthog-js'

posthog.init(process.env.NEXT_PUBLIC_POSTHOG_KEY, {
  api_host: process.env.NEXT_PUBLIC_POSTHOG_HOST,
  defaults: '2025-05-24',
})
```

**Key changes for Next.js migration:**
- Delete any `PostHogProvider` wrapper components
- Delete any `providers.tsx` file that only existed for PostHog
- Remove PostHog initialization from `useEffect` hooks
- Remove `'use client'` directives that were only needed for PostHog provider
- Import `posthog` directly where needed (no provider/hook required)

**Using PostHog in Next.js components:**
```typescript
// Any client component
'use client'
import posthog from 'posthog-js'

function MyComponent() {
  const handleClick = () => {
    posthog.capture('button_clicked', { button: 'signup' })
  }

  return <button onClick={handleClick}>Sign Up</button>
}
```

---

## React Projects (Non-Next.js)

For React apps without Next.js (Create React App, Vite, etc.), use the PostHogProvider pattern:

**BEFORE (Amplitude with React):**
```jsx
import { init } from '@amplitude/analytics-browser';
import { ampli } from './ampli';

function App() {
  useEffect(() => {
    init('AMPLITUDE_API_KEY');
    // or
    ampli.load({ client: { apiKey: 'AMPLITUDE_API_KEY' } });
  }, []);

  return <MyApp />;
}
```

**AFTER (PostHog with React):**
```jsx
import posthog from 'posthog-js';
import { PostHogProvider } from 'posthog-js/react';

// Initialize BEFORE rendering (outside component)
posthog.init(import.meta.env.VITE_PUBLIC_POSTHOG_KEY, {
  api_host: import.meta.env.VITE_PUBLIC_POSTHOG_HOST,
  defaults: '2025-05-24',
  capture_exceptions: true,
});

function App() {
  return (
    <PostHogProvider client={posthog}>
      <MyApp />
    </PostHogProvider>
  );
}
```

**Using the hook in components:**
```jsx
import { usePostHog } from 'posthog-js/react';

function MyComponent() {
  const posthog = usePostHog();

  const handleClick = () => {
    posthog.capture('button_clicked', { button: 'signup' });
  };

  return <button onClick={handleClick}>Sign Up</button>;
}
```

**IMPORTANT:** In non-Next.js React apps, use the `usePostHog` hook in components rather than importing `posthog` directly.

---

## Status

Report these status updates as you work:

- [STATUS] Migrating file: {filename}
- [STATUS] Replacing imports
- [STATUS] Updating initialization
- [STATUS] Converting tracking calls
- [STATUS] Completed: {filename}
