# Commandments Configuration
# Tag-based rules that get folded into skill descriptions
# Skills collect all commandments matching their tags

commandments:
  react:
    # PostHog-specific
    - For feature flags, use useFeatureFlagEnabled() or useFeatureFlagPayload() hooks - they handle loading states and external sync automatically
    - Add analytics capture in event handlers where user actions occur, NOT in useEffect reacting to state changes
    # General React patterns (react.dev/learn/you-might-not-need-an-effect)
    - Do NOT use useEffect for data transformation - calculate derived values during render instead
    - Do NOT use useEffect to respond to user events - put that logic in the event handler itself
    - Do NOT use useEffect to chain state updates - calculate all related updates together in the event handler
    - Do NOT use useEffect to notify parent components - call the parent callback alongside setState in the event handler
    - To reset component state when a prop changes, pass the prop as the component's key instead of using useEffect
    - useEffect is ONLY for synchronizing with external systems (non-React widgets, browser APIs, network subscriptions)

  nextjs:
    # Initialization
    - For Next.js 15.3+, initialize PostHog in instrumentation-client.ts for the simplest setup

  nextjs-feature-flags:
    # Client-side feature flags
    - The PostHog React hooks (useFeatureFlagEnabled, useFeatureFlagPayload) work WITHOUT PostHogProvider if posthog-js is already initialized (e.g., via instrumentation-client.ts)
    - In client components, import and use hooks directly - the React context defaults to the posthog-js singleton
    - Do NOT wrap components in PostHogProvider just for feature flags - it's unnecessary if posthog-js is initialized globally
    # Server-side feature flags
    - Server Components and Route Handlers cannot use React hooks - use posthog-node SDK instead
    - Create a server-side PostHog client with posthog-node, call getAllFlags() or getFeatureFlag(), then await posthog.shutdown()
    - Pass flag values from server to client components as props to avoid hydration mismatches
    # Avoiding flicker
    - For flags that affect initial render, evaluate server-side and pass as props to prevent UI flicker
    - Client-side hooks may return undefined initially while flags load - handle this loading state

  javascript:
    - Remember that source code is available in the node_modules directory
    - Check package.json for type checking or build scripts to validate changes
    - posthog-js is the JavaScript SDK package name

  python:
    - Remember that source code is available in the venv/site-packages directory
    - posthog is the Python SDK package name
    - Install dependencies with `pip install posthog` or `pip install -r requirements.txt` and do NOT use unquoted version specifiers like `>=` directly in shell commands

  django:
    - Add 'posthog.integrations.django.PosthogContextMiddleware' to MIDDLEWARE it auto-extracts tracing headers and captures exceptions
    - Initialize PostHog in AppConfig.ready() with api_key and host from environment variables
    - Use the context API pattern with new_context(), identify_context(user_id), then capture()
    - For login/logout views, create a new context since user state changes during the request
    - Do NOT create custom middleware, distinct_id helpers, or conditional checks - the SDK handles these

  flask:
    - Initialize PostHog globally in create_app() using posthog.api_key and posthog.host (NOT per-request)
    - Manually capture exceptions with `posthog.capture_exception(e)` for error tracking since Flask has built-in error handlers
    - Blueprint registration happens AFTER PostHog initialization in create_app()

  php:
    - Remember that source code is available in the vendor directory after composer install
    - posthog/posthog-php is the PHP SDK package name
    - Check composer.json for existing dependencies and autoload configuration before adding new files
    - The PHP SDK uses static methods (PostHog::capture, PostHog::identify) - initialize once with PostHog::init()
    - PHP SDK methods take associative arrays with 'distinctId', 'event', 'properties' keys - not positional arguments

  laravel:
    - Create a dedicated PostHogService class in app/Services/ - do NOT scatter PostHog::capture calls throughout controllers
    - Register PostHog configuration in config/posthog.php using env() for all settings (api_key, host, disabled)
    - Do NOT use Laravel's event system or observers for analytics - call capture explicitly where actions occur
  